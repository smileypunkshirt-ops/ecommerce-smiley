{"version":3,"file":"_slug_-BszxGSqz.js","sources":["../../../../pages/products/[slug].vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { storeToRefs } from \"pinia\";\nimport { useCartStore } from \"~/stores/cart\";\nimport type { CatalogProduct } from \"~/types/product\";\n\nconst route = useRoute();\nconst cart = useCartStore();\nconst { itemCount, loading: cartLoading, error: cartError, items: cartItems } = storeToRefs(cart);\n\nconst slug = computed(() => String(route.params.slug || \"\"));\n\nconst { data: product, pending, error } = await useAsyncData(\n  \"product-detail\",\n  () => $fetch<CatalogProduct>(`/api/catalog/products/${slug.value}`),\n  { watch: [slug] }\n);\n\nonMounted(() => {\n  cart.fetchCart();\n});\n\nconst displayPrice = computed(() => {\n  if (!product.value) return \"\";\n  return product.value.salePrice || product.value.price || product.value.regularPrice;\n});\n\nconst addToCart = async () => {\n  if (!product.value) return;\n  await cart.addItem(product.value.id, 1);\n};\n\nconst resolveQuantity = (value: unknown, fallback = 1) => {\n  if (typeof value === \"number\") return Number.isFinite(value) && value > 0 ? value : fallback;\n  if (typeof value === \"string\") {\n    const parsed = Number(value);\n    return Number.isFinite(parsed) && parsed > 0 ? parsed : fallback;\n  }\n  if (value && typeof value === \"object\") {\n    const record = value as Record<string, unknown>;\n    const candidates = [record.value, record.qty, record.quantity];\n    for (const candidate of candidates) {\n      const parsed = Number(candidate);\n      if (Number.isFinite(parsed) && parsed > 0) return parsed;\n    }\n  }\n  return fallback;\n};\n\nconst cartEntry = computed(() => {\n  if (!product.value) return null;\n  const productId = product.value.id;\n  const list = cartItems.value as Array<Record<string, unknown>>;\n  for (const item of list) {\n    const rawProductId = item.product_id ?? item.productId ?? item.id;\n    const id = Number(rawProductId);\n    if (!Number.isFinite(id) || id !== productId) continue;\n    const key = String(item.key || item.item_key || item.cart_item_key || item.id || item.product_id);\n    const quantity = resolveQuantity(item.quantity ?? item.qty ?? item.count ?? 1, 1);\n    return { key, quantity };\n  }\n  return null;\n});\n\nconst removeFromCart = async () => {\n  if (!cartEntry.value?.key) return;\n  await cart.removeItem(cartEntry.value.key);\n};\n\nuseHead(() => ({\n  title: product.value ? `${product.value.name} | Smiley Punk` : \"Producto\"\n}));\n</script>\n\n<template>\n  <div class=\"page\">\n    <div class=\"container\">\n      <AppHeader :item-count=\"itemCount\" />\n\n      <section class=\"pdp-layout\">\n        <div class=\"pdp-back-row\">\n          <NuxtLink class=\"pdp-back\" to=\"/\">Regresar al catalogo</NuxtLink>\n        </div>\n        <div class=\"pdp-media\">\n          <div class=\"pdp-image\">\n            <img v-if=\"product?.image\" :src=\"product.image\" :alt=\"product.imageAlt\" />\n            <span v-else>Sin imagen</span>\n          </div>\n        </div>\n        <div class=\"pdp-info\">\n          <p v-if=\"pending\">Cargando producto...</p>\n          <p v-else-if=\"error\">No se pudo cargar el producto.</p>\n          <div v-else-if=\"product\">\n            <span class=\"badge\">Playera Smiley</span>\n            <h1 class=\"hero-title\">{{ product.name }}</h1>\n            <p class=\"pdp-price\">$ {{ displayPrice }}</p>\n            <p class=\"hero-subtitle\">\n              {{ product.shortDescription || \"Playera clasica con corte regular.\" }}\n            </p>\n            <div class=\"pdp-actions\">\n              <button class=\"btn btn-primary\" type=\"button\" :disabled=\"cartLoading\" @click=\"addToCart\">\n                Agregar al carrito\n              </button>\n              <button\n                v-if=\"cartEntry\"\n                class=\"icon-btn\"\n                type=\"button\"\n                :disabled=\"cartLoading\"\n                aria-label=\"Eliminar del carrito\"\n                @click=\"removeFromCart\"\n              >\n                <svg viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n                  <path\n                    fill=\"currentColor\"\n                    d=\"M9 3h6l1 2h4v2H4V5h4l1-2zm1 6h2v8h-2V9zm4 0h2v8h-2V9zM7 9h2v8H7V9z\"\n                  />\n                </svg>\n              </button>\n            </div>\n            <p v-if=\"cartError\" class=\"hero-subtitle\">{{ cartError }}</p>\n          </div>\n        </div>\n      </section>\n\n      <section v-if=\"product\" class=\"pdp-details\">\n        <h2 class=\"section-title\">Descripcion</h2>\n        <p class=\"hero-subtitle\">\n          {{ product.description || \"Sin descripcion adicional por ahora.\" }}\n        </p>\n      </section>\n    </div>\n  </div>\n</template>\n"],"names":["_withAsyncContext","_ssrRenderAttrs","_mergeProps","_ssrRenderComponent","_unref","_push","_parent","_ssrInterpolate"],"mappings":"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"}