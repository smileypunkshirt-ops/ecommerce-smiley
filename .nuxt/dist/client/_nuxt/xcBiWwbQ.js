import{u as ft,a as vt,_ as bt}from"./zlUgwu3J.js";import{f as gt,s as _t,v as N,n as ht,r as st,g as f,h as Ct,c as l,a as e,i as g,b as k,u as s,w,T as I,o as i,e as kt,d as p,t as d,F as nt,j as at,x as j,y as _,z as h,A as rt}from"./CxzPJ4Pb.js";import{u as xt}from"./B8ZhceQh.js";const Nt={class:"page"},wt={class:"container"},$t={key:0,class:"checkout-loader","aria-live":"polite"},St={key:0,class:"checkout-content"},Tt={class:"checkout-back-row"},Pt={key:0,class:"order-complete"},Ut={class:"order-complete-card"},Et={class:"hero-subtitle"},Vt={class:"order-complete-actions"},Mt={class:"checkout-summary"},It={key:0,class:"summary-items"},Dt={class:"hero-subtitle"},Rt={class:"summary-row"},qt={class:"summary-row"},At={class:"summary-row"},Ft={class:"summary-row"},Lt={class:"summary-total"},jt={key:1,class:"checkout-layout"},Bt={class:"checkout-accordion"},zt=["aria-expanded"],Ot={key:0,class:"accordion-panel"},Ht={class:"form-grid"},Xt={class:"form-field"},Gt={class:"form-field"},Qt={class:"form-field"},Wt={class:"form-field"},Jt={class:"form-field form-field-full"},Kt={class:"form-field"},Yt={class:"form-field"},Zt={class:"form-field"},te={class:"form-field"},ee={class:"accordion-actions"},oe=["aria-expanded"],se={key:0,class:"accordion-panel"},ne={class:"form-grid"},ae={class:"form-field form-field-full"},re={class:"form-field form-field-full"},le={class:"form-field form-field-full"},ie=["value"],de={class:"form-field"},ue=["value"],ce={class:"form-field"},pe={class:"accordion-actions"},me=["aria-expanded"],ye={key:0,class:"accordion-panel"},fe={class:"accordion-actions"},ve=["disabled"],be={key:0,class:"hero-subtitle"},ge={key:1,class:"hero-subtitle"},_e={class:"checkout-summary"},he={key:0},Ce={key:1,class:"hero-subtitle"},ke={key:2,class:"summary-items"},xe={class:"hero-subtitle"},Ne={key:3,class:"cart-empty"},we={class:"summary-row"},$e={class:"summary-row"},Se={class:"summary-row"},Te={class:"summary-row"},Pe={class:"summary-total"},De=gt({__name:"checkout",setup(Ue){xt({title:"Checkout | Smiley Punk"});const B=ft(),{cart:v,items:z,loading:O,error:H,itemCount:Ee}=_t(B);vt("checkout-cart",()=>B.fetchCart(),{server:!1});const D=N(!0);ht(()=>{setTimeout(()=>{D.value=!1},2e3)});const u=N("shipping"),a=st({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",state:"",postalCode:"",country:"Mexico"}),c=st({method:"card",cardName:"",cardNumber:"",cardExpiry:"",cardCvc:""}),U=N(!1),x=N(""),E=N(""),X=N(!1),R=N(null),lt=o=>o.replace(/\D/g,"").slice(0,16).replace(/(\d{4})(?=\d)/g,"$1 "),it=o=>{const t=o.replace(/\D/g,"").slice(0,4);return t.length<=2?t:`${t.slice(0,2)}/${t.slice(2)}`},dt=o=>{const t=o.target;t&&(c.cardNumber=lt(t.value))},ut=o=>{const t=o.target;t&&(c.cardExpiry=it(t.value))},q=f(()=>a.firstName.trim()&&a.lastName.trim()&&a.email.trim().includes("@")&&a.phone.trim()&&a.address.trim()&&a.city.trim()&&a.state.trim()&&a.postalCode.trim()&&a.country.trim()),G=f(()=>c.method!=="card"?!0:c.cardName.trim()&&c.cardNumber.trim()&&c.cardExpiry.trim()&&c.cardCvc.trim()),$=f(()=>!!q.value),V=f(()=>!!(q.value&&G.value)),Q=o=>o==="payment"&&!$.value?"shipping":o==="review"&&!V.value?$.value?"payment":"shipping":o,A=o=>{const t=Q(o);u.value=u.value===t?"":t},W=o=>{u.value=Q(o)};Ct([$,V],()=>{if(u.value==="review"&&!V.value){u.value=$.value?"payment":"shipping";return}u.value==="payment"&&!$.value&&(u.value="shipping")});const J=(o,t=1)=>{if(typeof o=="number")return Number.isFinite(o)&&o>0?o:t;if(typeof o=="string"){const r=Number(o);return Number.isFinite(r)&&r>0?r:t}if(o&&typeof o=="object"){const r=o,m=[r.value,r.qty,r.quantity];for(const n of m){const y=Number(n);if(Number.isFinite(y)&&y>0)return y}}return t},P=f(()=>z.value.map((o,t)=>{const r=String(o.key||o.item_key||o.cart_item_key||o.id||o.product_id||t),m=String(o.name||o.title||"Producto"),n=J(o.quantity??o.qty??1,1),y=o.totals?.total||o.line_total||o.line_total_raw||o.price;return{key:r,name:m,quantity:n,lineTotal:y}})),K=f(()=>z.value.map((o,t)=>{const r=o.product_id??o.productId??o.id,m=o.variation_id??o.variationId,n=Number(r),y=Number(m),S=J(o.quantity??o.qty??1,1);return Number.isFinite(n)?{product_id:n,variation_id:Number.isFinite(y)?y:void 0,quantity:S}:null}).filter(Boolean)),ct=o=>{const t=o.trim().toLowerCase();return t==="mexico"||t==="méxico"?"MX":t==="estados unidos"||t==="usa"||t==="us"?"US":t==="canada"||t==="canadá"?"CA":o},pt=async()=>{if(x.value="",E.value="",!q.value){x.value="Completa los datos de envio para continuar.",u.value="shipping";return}if(!G.value){x.value="Completa los datos de pago para continuar.",u.value="payment";return}if(!K.value.length){x.value="Tu carrito esta vacio.";return}U.value=!0;try{const o=ct(a.country),t={payment_method:c.method,payment_method_title:c.method==="card"?"Tarjeta":"Pago",set_paid:!1,billing:{first_name:a.firstName,last_name:a.lastName,address_1:a.address,city:a.city,state:a.state,postcode:a.postalCode,country:o,email:a.email,phone:a.phone},shipping:{first_name:a.firstName,last_name:a.lastName,address_1:a.address,city:a.city,state:a.state,postcode:a.postalCode,country:o},line_items:K.value},r=await $fetch("/api/checkout/order",{method:"POST",body:t});R.value=r?.id??null,E.value=r?.id?`Pedido creado con folio #${r.id}.`:"Pedido creado correctamente.",X.value=!0}catch(o){x.value=o instanceof Error?o.message:"No se pudo crear el pedido."}finally{U.value=!1}},F=f(()=>{const o=v.value||{},t=o.currency||{},r=Number(t.currency_minor_unit??t.decimals??2);return{symbol:String(o.currency_symbol||t.symbol||"$"),decimalSeparator:String(t.decimal_separator||"."),thousandSeparator:String(t.thousand_separator||","),symbolPosition:String(t.currency_symbol_position||t.symbol_position||"left"),minorUnit:Number.isFinite(r)?r:2}}),mt=f(()=>{const t=(v.value||{}).totals;if(!t)return!1;const r=Object.values(t).filter(n=>typeof n=="string"||typeof n=="number");if(r.length===0)return!1;const{decimalSeparator:m}=F.value;return!r.some(n=>{if(typeof n=="number")return!Number.isInteger(n);const y=n.trim();return y.includes(m)||y.includes(".")})}),yt=o=>{if(o==null)return null;if(typeof o=="number")return o;const t=o.trim();if(!t)return null;const{decimalSeparator:r,thousandSeparator:m,minorUnit:n}=F.value,y=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),S=m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),L=new RegExp(`[^0-9\\-\\${y}\\${S}]`,"g");let C=t.replace(L,"");m&&(C=C.replace(new RegExp(S,"g"),"")),r&&r!=="."&&(C=C.replace(new RegExp(y,"g"),"."));const M=C.includes("."),T=Number(C);return Number.isFinite(T)?!M&&mt.value&&n>0?T/Math.pow(10,n):T:null},b=o=>{const t=F.value,r=yt(o);if(r===null)return`${t.symbol}0.00`;const m=r<0,y=Math.abs(r).toFixed(t.minorUnit),[S,L]=y.split("."),C=S.replace(/\B(?=(\d{3})+(?!\d))/g,t.thousandSeparator),M=t.minorUnit>0?`${C}${t.decimalSeparator}${L}`:C,T=t.symbolPosition==="right"?`${M}${t.symbol}`:`${t.symbol}${M}`;return m?`-${T}`:T},Y=f(()=>v.value?.totals?.subtotal||v.value?.subtotal||0),Z=f(()=>v.value?.totals?.total_tax||v.value?.total_tax||0),tt=f(()=>v.value?.totals?.shipping_total||v.value?.shipping_total||0),et=f(()=>v.value?.totals?.discount_total||v.value?.discount_total||0),ot=f(()=>v.value?.totals?.total||v.value?.total||0);return(o,t)=>{const r=bt,m=kt;return i(),l("div",Nt,[e("div",wt,[s(D)?(i(),l("div",$t,[...t[17]||(t[17]=[e("div",{class:"loader-spinner"},null,-1),e("p",{class:"hero-subtitle"},"Preparando checkout...",-1)])])):g("",!0),k(I,{name:"checkout-fade"},{default:w(()=>[s(D)?g("",!0):(i(),l("div",St,[k(r,{centered:""}),e("div",Tt,[k(m,{class:"pdp-back",to:"/cart"},{default:w(()=>[...t[18]||(t[18]=[p("Regresar al carrito",-1)])]),_:1})]),t[52]||(t[52]=e("div",{class:"checkout-title-row"},[e("h1",{class:"hero-title"},"Checkout")],-1)),s(X)?(i(),l("div",Pt,[e("div",Ut,[t[21]||(t[21]=e("span",{class:"badge"},"Pedido confirmado",-1)),t[22]||(t[22]=e("h2",{class:"hero-title"},"Gracias por tu compra",-1)),e("p",Et,d(s(R)?`Tu folio es #${s(R)}.`:"Tu pedido fue creado exitosamente."),1),e("div",Vt,[k(m,{class:"btn btn-primary",to:"/"},{default:w(()=>[...t[19]||(t[19]=[p("Seguir comprando",-1)])]),_:1}),k(m,{class:"btn btn-secondary",to:"/cart"},{default:w(()=>[...t[20]||(t[20]=[p("Ver carrito",-1)])]),_:1})])]),e("aside",Mt,[t[28]||(t[28]=e("h2",{class:"section-title"},"Resumen",-1)),s(P).length?(i(),l("div",It,[(i(!0),l(nt,null,at(s(P),n=>(i(),l("div",{key:n.key,class:"summary-item"},[e("div",null,[e("strong",null,d(n.name),1),e("p",Dt,"Cantidad: "+d(n.quantity),1)]),e("span",null,d(b(n.lineTotal)),1)]))),128))])):g("",!0),e("div",Rt,[t[23]||(t[23]=e("span",null,"Subtotal",-1)),e("span",null,d(b(s(Y))),1)]),e("div",qt,[t[24]||(t[24]=e("span",null,"Descuento",-1)),e("span",null,"- "+d(b(s(et))),1)]),e("div",At,[t[25]||(t[25]=e("span",null,"Envio",-1)),e("span",null,d(b(s(tt))),1)]),e("div",Ft,[t[26]||(t[26]=e("span",null,"Impuestos",-1)),e("span",null,d(b(s(Z))),1)]),e("div",Lt,[t[27]||(t[27]=e("span",null,"Total",-1)),e("strong",null,d(b(s(ot))),1)])])])):(i(),l("div",jt,[e("section",Bt,[e("div",{class:j(["accordion-item",{open:s(u)==="shipping"}])},[e("button",{class:"accordion-header",type:"button","aria-expanded":s(u)==="shipping",onClick:t[0]||(t[0]=n=>A("shipping"))}," 1. Datos de envio ",8,zt),k(I,{name:"accordion"},{default:w(()=>[s(u)==="shipping"?(i(),l("div",Ot,[e("div",Ht,[e("label",Xt,[t[29]||(t[29]=p(" Nombre ",-1)),_(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>s(a).firstName=n),type:"text",placeholder:"Andrea"},null,512),[[h,s(a).firstName]])]),e("label",Gt,[t[30]||(t[30]=p(" Apellido ",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>s(a).lastName=n),type:"text",placeholder:"Lopez"},null,512),[[h,s(a).lastName]])]),e("label",Qt,[t[31]||(t[31]=p(" Email ",-1)),_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>s(a).email=n),type:"email",placeholder:"hola@correo.com"},null,512),[[h,s(a).email]])]),e("label",Wt,[t[32]||(t[32]=p(" Telefono ",-1)),_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>s(a).phone=n),type:"tel",placeholder:"55 1234 5678"},null,512),[[h,s(a).phone]])]),e("label",Jt,[t[33]||(t[33]=p(" Direccion ",-1)),_(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>s(a).address=n),type:"text",placeholder:"Calle 123, Colonia"},null,512),[[h,s(a).address]])]),e("label",Kt,[t[34]||(t[34]=p(" Ciudad ",-1)),_(e("input",{"onUpdate:modelValue":t[6]||(t[6]=n=>s(a).city=n),type:"text",placeholder:"CDMX"},null,512),[[h,s(a).city]])]),e("label",Yt,[t[35]||(t[35]=p(" Estado ",-1)),_(e("input",{"onUpdate:modelValue":t[7]||(t[7]=n=>s(a).state=n),type:"text",placeholder:"Ciudad de Mexico"},null,512),[[h,s(a).state]])]),e("label",Zt,[t[36]||(t[36]=p(" Codigo postal ",-1)),_(e("input",{"onUpdate:modelValue":t[8]||(t[8]=n=>s(a).postalCode=n),type:"text",placeholder:"01000"},null,512),[[h,s(a).postalCode]])]),e("label",te,[t[38]||(t[38]=p(" Pais ",-1)),_(e("select",{"onUpdate:modelValue":t[9]||(t[9]=n=>s(a).country=n)},[...t[37]||(t[37]=[e("option",null,"Mexico",-1),e("option",null,"Estados Unidos",-1),e("option",null,"Canada",-1)])],512),[[rt,s(a).country]])])]),e("div",ee,[e("button",{class:"btn btn-secondary",type:"button",onClick:t[10]||(t[10]=n=>W("payment"))}," Continuar a pago ")])])):g("",!0)]),_:1})],2),s($)?(i(),l("div",{key:0,class:j(["accordion-item",{open:s(u)==="payment"}])},[e("button",{class:"accordion-header",type:"button","aria-expanded":s(u)==="payment",onClick:t[11]||(t[11]=n=>A("payment"))}," 2. Metodo de pago ",8,oe),k(I,{name:"accordion"},{default:w(()=>[s(u)==="payment"?(i(),l("div",se,[e("div",ne,[e("label",ae,[t[40]||(t[40]=p(" Metodo ",-1)),_(e("select",{"onUpdate:modelValue":t[12]||(t[12]=n=>s(c).method=n)},[...t[39]||(t[39]=[e("option",{value:"card"},"Tarjeta",-1),e("option",{value:"transfer"},"Transferencia",-1),e("option",{value:"cash"},"Pago en efectivo",-1)])],512),[[rt,s(c).method]])]),e("label",re,[t[41]||(t[41]=p(" Nombre en tarjeta ",-1)),_(e("input",{"onUpdate:modelValue":t[13]||(t[13]=n=>s(c).cardName=n),type:"text",placeholder:"Andrea Lopez"},null,512),[[h,s(c).cardName]])]),e("label",le,[t[42]||(t[42]=p(" Numero de tarjeta ",-1)),e("input",{value:s(c).cardNumber,type:"text",inputmode:"numeric",autocomplete:"cc-number",placeholder:"4242 4242 4242 4242",onInput:dt},null,40,ie)]),e("label",de,[t[43]||(t[43]=p(" Expiracion ",-1)),e("input",{value:s(c).cardExpiry,type:"text",inputmode:"numeric",autocomplete:"cc-exp",placeholder:"MM/AA",onInput:ut},null,40,ue)]),e("label",ce,[t[44]||(t[44]=p(" CVC ",-1)),_(e("input",{"onUpdate:modelValue":t[14]||(t[14]=n=>s(c).cardCvc=n),type:"text",placeholder:"123"},null,512),[[h,s(c).cardCvc]])])]),e("div",pe,[e("button",{class:"btn btn-secondary",type:"button",onClick:t[15]||(t[15]=n=>W("review"))}," Revisar pedido ")])])):g("",!0)]),_:1})],2)):g("",!0),s(V)?(i(),l("div",{key:1,class:j(["accordion-item",{open:s(u)==="review"}])},[e("button",{class:"accordion-header",type:"button","aria-expanded":s(u)==="review",onClick:t[16]||(t[16]=n=>A("review"))}," 3. Confirmacion ",8,me),k(I,{name:"accordion"},{default:w(()=>[s(u)==="review"?(i(),l("div",ye,[t[45]||(t[45]=e("p",{class:"hero-subtitle"}," Revisa tu informacion y confirma el pedido. El checkout final se conectara con WooCommerce. ",-1)),e("div",fe,[e("button",{class:"btn btn-primary",type:"button",disabled:s(O)||s(U)||s(P).length===0,onClick:pt},d(s(U)?"Procesando...":"Realizar pedido"),9,ve)]),s(x)?(i(),l("p",be,d(s(x)),1)):g("",!0),s(E)?(i(),l("p",ge,d(s(E)),1)):g("",!0)])):g("",!0)]),_:1})],2)):g("",!0)]),e("aside",_e,[t[51]||(t[51]=e("h2",{class:"section-title"},"Resumen",-1)),s(O)?(i(),l("p",he,"Cargando resumen...")):g("",!0),s(H)?(i(),l("p",Ce,d(s(H)),1)):g("",!0),s(P).length?(i(),l("div",ke,[(i(!0),l(nt,null,at(s(P),n=>(i(),l("div",{key:n.key,class:"summary-item"},[e("div",null,[e("strong",null,d(n.name),1),e("p",xe,"Cantidad: "+d(n.quantity),1)]),e("span",null,d(b(n.lineTotal)),1)]))),128))])):(i(),l("div",Ne,"Tu carrito esta vacio.")),e("div",we,[t[46]||(t[46]=e("span",null,"Subtotal",-1)),e("span",null,d(b(s(Y))),1)]),e("div",$e,[t[47]||(t[47]=e("span",null,"Descuento",-1)),e("span",null,"- "+d(b(s(et))),1)]),e("div",Se,[t[48]||(t[48]=e("span",null,"Envio",-1)),e("span",null,d(b(s(tt))),1)]),e("div",Te,[t[49]||(t[49]=e("span",null,"Impuestos",-1)),e("span",null,d(b(s(Z))),1)]),e("div",Pe,[t[50]||(t[50]=e("span",null,"Total",-1)),e("strong",null,d(b(s(ot))),1)])])]))]))]),_:1})])])}}});export{De as default};
