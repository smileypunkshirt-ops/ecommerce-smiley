import{g as B,C as A,D,h as F,E as K,G as $,H as x,v as z,I as R,J as Q,K as W,L as J,u as T,M as Y,N as X,O as Z,P as k,Q as tt,f as et,c as I,b as at,k as rt,i as nt,w as q,a as w,t as S,x as st,e as it,o as N,l as ot,R as ct,S as lt}from"./CxzPJ4Pb.js";const ut={trailing:!0};function ft(t,e=25,s={}){if(s={...ut,...s},!Number.isFinite(e))throw new TypeError("Expected `wait` to be a finite number");let i,a,l=[],n,r;const d=(c,y)=>(n=dt(t,c,y),n.finally(()=>{if(n=null,s.trailing&&r&&!a){const v=d(c,r);return r=null,v}}),n),g=function(...c){return s.trailing&&(r=c),n||new Promise(y=>{const v=!a&&s.leading;clearTimeout(a),a=setTimeout(()=>{a=null;const u=s.leading?i:d(this,c);r=null;for(const h of l)h(u);l=[]},e),v?(i=d(this,c),y(i)):l.push(y)})},o=c=>{c&&(clearTimeout(c),a=null)};return g.isPending=()=>!!a,g.cancel=()=>{o(a),l=[],r=null},g.flush=()=>{if(o(a),!r||n)return;const c=r;return r=null,d(this,c)},g}async function dt(t,e,s){return await t.apply(e,s)}const mt=Symbol.for("nuxt:client-only"),ht=t=>t==="defer"||t===!1;function Ot(...t){const e=typeof t[t.length-1]=="string"?t.pop():void 0;yt(t[0],t[1])&&t.unshift(e);let[s,i,a={}]=t,l=!1;const n=B(()=>$(s));if(typeof n.value!="string")throw new TypeError("[nuxt] [useAsyncData] key must be a string.");if(typeof i!="function")throw new TypeError("[nuxt] [useAsyncData] handler must be a function.");const r=A();a.server??=!0,a.default??=gt,a.getCachedData??=G,a.lazy??=!1,a.immediate??=!0,a.deep??=D.deep,a.dedupe??="cancel",a._functionName,r._asyncData[n.value];function d(){const u={cause:"initial",dedupe:a.dedupe};return r._asyncData[n.value]?._init||(u.cachedData=a.getCachedData(n.value,r,{cause:"initial"}),r._asyncData[n.value]=U(r,n.value,i,a,u.cachedData)),()=>r._asyncData[n.value].execute(u)}const g=d(),o=r._asyncData[n.value];o._deps++;const c=a.server!==!1&&r.payload.serverRendered;{let u=function(m){const f=r._asyncData[m];f?._deps&&(f._deps--,f._deps===0&&f?._off())};const h=Y();if(h&&c&&a.immediate&&!h.sp&&(h.sp=[]),h&&!h._nuxtOnBeforeMountCbs){h._nuxtOnBeforeMountCbs=[];const m=h._nuxtOnBeforeMountCbs;X(()=>{m.forEach(f=>{f()}),m.splice(0,m.length)}),Z(()=>m.splice(0,m.length))}const E=h&&(h._nuxtClientOnly||k(mt,!1));c&&r.isHydrating&&(o.error.value||o.data.value!=null)?(o.pending.value=!1,o.status.value=o.error.value?"error":"success"):h&&(!E&&r.payload.serverRendered&&r.isHydrating||a.lazy)&&a.immediate?h._nuxtOnBeforeMountCbs.push(g):a.immediate&&g();const _=x(),b=F(n,(m,f)=>{if((m||f)&&m!==f){l=!0;const M=r._asyncData[f]?.data.value!==D.value,H=r._asyncDataPromises[f]!==void 0,V={cause:"initial",dedupe:a.dedupe};if(!r._asyncData[m]?._init){let P;f&&M?P=r._asyncData[f].data.value:(P=a.getCachedData(m,r,{cause:"initial"}),V.cachedData=P),r._asyncData[m]=U(r,m,i,a,P)}r._asyncData[m]._deps++,f&&u(f),(a.immediate||M||H)&&r._asyncData[m].execute(V),tt(()=>{l=!1})}},{flush:"sync"}),C=a.watch?F(a.watch,()=>{l||r._asyncData[n.value]?._execute({cause:"watch",dedupe:a.dedupe})}):()=>{};_&&K(()=>{b(),C(),u(n.value)})}const y={data:O(()=>r._asyncData[n.value]?.data),pending:O(()=>r._asyncData[n.value]?.pending),status:O(()=>r._asyncData[n.value]?.status),error:O(()=>r._asyncData[n.value]?.error),refresh:(...u)=>r._asyncData[n.value]?._init?r._asyncData[n.value].execute(...u):d()(),execute:(...u)=>y.refresh(...u),clear:()=>{const u=r._asyncData[n.value];if(u?._abortController)try{u._abortController.abort(new DOMException("AsyncData aborted by user.","AbortError"))}finally{u._abortController=void 0}j(r,n.value)}},v=Promise.resolve(r._asyncDataPromises[n.value]).then(()=>y);return Object.assign(v,y),v}function O(t){return B({get(){return t()?.value},set(e){const s=t();s&&(s.value=e)}})}function yt(t,e){return!(typeof t=="string"||typeof t=="object"&&t!==null||typeof t=="function"&&typeof e=="function")}function j(t,e){e in t.payload.data&&(t.payload.data[e]=void 0),e in t.payload._errors&&(t.payload._errors[e]=D.errorValue),t._asyncData[e]&&(t._asyncData[e].data.value=void 0,t._asyncData[e].error.value=D.errorValue,t._asyncData[e].pending.value=!1,t._asyncData[e].status.value="idle"),e in t._asyncDataPromises&&(t._asyncDataPromises[e]=void 0)}function _t(t,e){const s={};for(const i of e)s[i]=t[i];return s}function U(t,e,s,i,a){t.payload._errors[e]??=D.errorValue;const l=i.getCachedData!==G,n=s,r=i.deep?z:R,d=a!=null,g=t.hook("app:data:refresh",async c=>{(!c||c.includes(e))&&await o.execute({cause:"refresh:hook"})}),o={data:r(d?a:i.default()),pending:R(!d),error:Q(t.payload._errors,e),status:R("idle"),execute:(...c)=>{const[y,v=void 0]=c,u=y&&v===void 0&&typeof y=="object"?y:{};if(t._asyncDataPromises[e]&&ht(u.dedupe??i.dedupe))return t._asyncDataPromises[e];if(u.cause==="initial"||t.isHydrating){const _="cachedData"in u?u.cachedData:i.getCachedData(e,t,{cause:u.cause??"refresh:manual"});if(_!=null)return t.payload.data[e]=o.data.value=_,o.error.value=D.errorValue,o.status.value="success",Promise.resolve(_)}o.pending.value=!0,o._abortController&&o._abortController.abort(new DOMException("AsyncData request cancelled by deduplication","AbortError")),o._abortController=new AbortController,o.status.value="pending";const h=new AbortController,E=new Promise((_,b)=>{try{const C=u.timeout??i.timeout,m=bt([o._abortController?.signal,u?.signal],h.signal,C);if(m.aborted){const f=m.reason;b(f instanceof Error?f:new DOMException(String(f??"Aborted"),"AbortError"));return}return m.addEventListener("abort",()=>{const f=m.reason;b(f instanceof Error?f:new DOMException(String(f??"Aborted"),"AbortError"))},{once:!0,signal:h.signal}),Promise.resolve(n(t,{signal:m})).then(_,b)}catch(C){b(C)}}).then(async _=>{let b=_;i.transform&&(b=await i.transform(_)),i.pick&&(b=_t(b,i.pick)),t.payload.data[e]=b,o.data.value=b,o.error.value=D.errorValue,o.status.value="success"}).catch(_=>{if(t._asyncDataPromises[e]&&t._asyncDataPromises[e]!==E||o._abortController?.signal.aborted)return t._asyncDataPromises[e];if(typeof DOMException<"u"&&_ instanceof DOMException&&_.name==="AbortError")return o.status.value="idle",t._asyncDataPromises[e];o.error.value=J(_),o.data.value=T(i.default()),o.status.value="error"}).finally(()=>{o.pending.value=!1,h.abort(),delete t._asyncDataPromises[e]});return t._asyncDataPromises[e]=E,t._asyncDataPromises[e]},_execute:ft((...c)=>o.execute(...c),0,{leading:!0}),_default:i.default,_deps:0,_init:!0,_hash:void 0,_off:()=>{g(),t._asyncData[e]?._init&&(t._asyncData[e]._init=!1),l||W(()=>{t._asyncData[e]?._init||(j(t,e),o.execute=()=>Promise.resolve(),o.data.value=D.value)})}};return o}const gt=()=>D.value,G=(t,e,s)=>{if(e.isHydrating)return e.payload.data[t];if(s.cause!=="refresh:manual"&&s.cause!=="refresh:hook")return e.static.data[t]};function bt(t,e,s){const i=t.filter(n=>!!n);if(typeof s=="number"&&s>=0){const n=AbortSignal.timeout?.(s);n&&i.push(n)}if(AbortSignal.any)return AbortSignal.any(i);const a=new AbortController;for(const n of i)if(n.aborted){const r=n.reason??new DOMException("Aborted","AbortError");try{a.abort(r)}catch{a.abort()}return a.signal}const l=()=>{const r=i.find(d=>d.aborted)?.reason??new DOMException("Aborted","AbortError");try{a.abort(r)}catch{a.abort()}};for(const n of i)n.addEventListener?.("abort",l,{once:!0,signal:e});return a.signal}const Dt=""+new URL("smileypunk_logo.DkBNFv78.png",import.meta.url).href,vt=["src"],Ct={key:1,class:"cart-pill"},Tt=et({__name:"AppHeader",props:{itemCount:{},cartLabel:{default:"Carrito"},cartLink:{default:"/cart"},centered:{type:Boolean,default:!1}},setup(t){const e=t,s=B(()=>!e.centered&&typeof e.itemCount=="number");return(i,a)=>{const l=it;return N(),I("header",{class:st(["topbar app-header",{"is-centered":t.centered}])},[at(l,{class:"brand",to:"/"},{default:q(()=>[w("img",{class:"brand-logo",src:T(Dt),alt:"Smiley Punk"},null,8,vt)]),_:1}),T(s)&&t.cartLink?(N(),rt(l,{key:0,class:"cart-pill",to:t.cartLink},{default:q(()=>[w("span",null,S(t.cartLabel),1),w("strong",null,S(t.itemCount),1)]),_:1},8,["to"])):T(s)?(N(),I("div",Ct,[w("span",null,S(t.cartLabel),1),w("strong",null,S(t.itemCount),1)])):nt("",!0)],2)}}}),L="smiley_cart_key",wt=()=>{try{return window.localStorage.getItem(L)}catch{return null}},pt=t=>{try{t?window.localStorage.setItem(L,t):window.localStorage.removeItem(L)}catch{}},Et=t=>{if(!t)return[];const e=t.items||t.cart_items;return e?Array.isArray(e)?e:typeof e=="object"?Object.entries(e).map(([s,i])=>i&&typeof i=="object"?{key:s,...i}:{key:s,value:i}):[]:[]},Pt=t=>t.length?t.reduce((e,s)=>{if(!s||typeof s!="object")return e+1;const i=s.quantity??s.qty??1,a=Number(i);return e+(Number.isFinite(a)&&a>0?a:1)},0):0,p=t=>t?"items"in t||"cart_items"in t||"item_count"in t||"totals"in t:!1,Rt=ot("cart",{state:()=>({cart:null,items:[],itemCount:0,cartKey:null,loading:!1,error:null}),actions:{async fetchCart(){return await this.requestCart("/cart","GET")},async addItem(t,e=1,s,i){const a=await this.requestCart("/cart/add-item","POST",{id:t,product_id:t,quantity:e,variation_id:s,variation:i,return_cart:!0});if(p(a)||await this.fetchCart(),a){const{open:l}=lt();l()}return a},async updateItem(t,e){const s=await this.requestCart(`/cart/item/${encodeURIComponent(t)}`,"POST",{quantity:e,return_cart:!0});if(s)return p(s)||await this.fetchCart(),s;const i=await this.requestCart("/cart/item","POST",{key:t,item_key:t,cart_item_key:t,quantity:e,return_cart:!0});return p(i)||await this.fetchCart(),i},async removeItem(t){const e=await this.requestCart(`/cart/item/${encodeURIComponent(t)}`,"DELETE");return p(e)||await this.fetchCart(),e},async requestCart(t,e,s){this.loading=!0,this.error=null;const a=ct().public.apiBase;try{this.cartKey||(this.cartKey=wt());const l=new URL(`${a}/wp-json/cocart/v2${t}`);this.cartKey&&l.searchParams.set("cart_key",this.cartKey);const n=e==="GET"?void 0:{...s||{},...this.cartKey&&!("cart_key"in(s||{}))?{cart_key:this.cartKey}:{}},r=n&&e!=="GET"?new URLSearchParams(Object.entries(n).reduce((o,[c,y])=>(y==null||(o[c]=String(y)),o),{})):void 0,d=await $fetch(l.toString(),{method:e,body:r,credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}});if(p(d)){this.cart=d,this.items=Et(d);const o=Pt(this.items),c=Number(d.item_count);this.itemCount=o||(Number.isFinite(c)?c:this.items.length)}const g=typeof d.cart_key=="string"?d.cart_key:typeof d.cartKey=="string"?d.cartKey:null;return g&&(this.cartKey=g,pt(g)),d}catch(l){const n=typeof l?.data?.message=="string"?l.data?.message:l instanceof Error?l.message:"Cart request failed";return this.error=n,null}finally{this.loading=!1}}}});export{Tt as _,Ot as a,Rt as u};
