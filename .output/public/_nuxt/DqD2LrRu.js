import{u as tt,a as st,_ as ot}from"./zlUgwu3J.js";import{f as nt,s as et,r as rt,g as _,h as at,c as m,o as p,a as o,b as P,u as r,w as U,d as j,e as it,i as B,t as f,F as ct,j as lt,k as ut}from"./CxzPJ4Pb.js";import{u as dt}from"./B8ZhceQh.js";const pt={class:"page"},yt={class:"container"},mt={class:"cart-back-row"},ft={class:"cart-layout"},bt={class:"cart-items"},_t={key:0},gt={key:1,class:"hero-subtitle"},vt={key:2,class:"cart-empty"},ht={key:3,class:"cart-list"},kt={class:"cart-item-media"},Nt={class:"cart-item-image"},wt=["src","alt"],$t={key:1},It={class:"cart-item-body"},St={class:"cart-item-header"},Ct=["disabled","onClick"],xt={class:"hero-subtitle"},qt={class:"cart-item-controls"},Ft={class:"qty"},Tt={class:"qty-controls"},Pt=["disabled","onClick"],Ut={class:"qty-value"},jt=["disabled","onClick"],Bt={class:"cart-item-total"},Rt={class:"cart-summary"},Et={class:"summary-row"},Mt={class:"summary-row"},Vt={class:"summary-row"},At={class:"summary-row"},Dt={class:"summary-total"},Lt={key:1,class:"btn btn-primary",type:"button",disabled:""},zt=nt({__name:"cart",setup(Qt){dt({title:"Carrito | Smiley Punk"});const $=tt(),{cart:c,items:L,loading:h,error:R,itemCount:Q}=et($);st("cart",()=>$.fetchCart(),{server:!1});const x=rt({}),E=(s,t=1)=>{if(typeof s=="number")return Number.isFinite(s)&&s>0?s:t;if(typeof s=="string"){const n=Number(s);return Number.isFinite(n)&&n>0?n:t}if(s&&typeof s=="object"){const n=s,a=[n.value,n.qty,n.quantity];for(const e of a){const i=Number(e);if(Number.isFinite(i)&&i>0)return i}}return t},q=_(()=>L.value.map((s,t)=>{const n=d=>{const y=d.slug||d.product_slug;if(typeof y=="string"&&y.trim())return`/products/${y}`;const b=d.permalink||d.url||d.link;if(typeof b=="string"&&b.trim())try{const v=new URL(b).pathname.split("/").filter(Boolean),S=v[v.length-1];if(S)return`/products/${S}`}catch{}},a=d=>{const y=d.image;if(typeof y=="string")return y;if(y&&typeof y=="object"){const l=y.src,C=y.url;if(typeof l=="string")return l;if(typeof C=="string")return C}const b=d.featured_image;if(typeof b=="string")return b;if(b&&typeof b=="object"){const l=b.src;if(typeof l=="string")return l}const F=d.images;if(Array.isArray(F)&&F.length>0){const l=F[0];if(typeof l=="string")return l;if(l&&typeof l=="object"){const C=l.src;if(typeof C=="string")return C}}const v=d.thumbnail;if(typeof v=="string")return v;if(v&&typeof v=="object"){const l=v.src;if(typeof l=="string")return l}const S=d.image_url;if(typeof S=="string")return S},e=String(s.key||s.item_key||s.cart_item_key||s.id||s.product_id||t),i=String(s.name||s.title||"Producto"),N=E(s.quantity??s.qty??1,1),I=s.price||s.totals?.subtotal||s.line_subtotal,u=s.totals?.total||s.line_total||s.line_total_raw,w=a(s),g=s.product_id??s.productId??s.id,Y=s.variation_id??s.variationId,A=Number(g),D=Number(Y),Z=s.variation||s.attributes;return{key:e,name:i,quantity:N,price:I,lineTotal:u,image:w,productId:Number.isFinite(A)?A:null,variationId:Number.isFinite(D)?D:null,variation:Z,link:n(s)}}));at(q,s=>{s.forEach(t=>{x[t.key]=E(t.quantity,1)})},{immediate:!0}),_(()=>c.value?.currency_symbol||c.value?.currency?.symbol||"$");const T=_(()=>{const s=c.value||{},t=s.currency||{},n=Number(t.currency_minor_unit??t.decimals??2);return{symbol:String(s.currency_symbol||t.symbol||"$"),decimalSeparator:String(t.decimal_separator||"."),thousandSeparator:String(t.thousand_separator||","),symbolPosition:String(t.currency_symbol_position||t.symbol_position||"left"),minorUnit:Number.isFinite(n)?n:2}}),H=_(()=>{const t=(c.value||{}).totals;if(!t)return!1;const n=Object.values(t).filter(e=>typeof e=="string"||typeof e=="number");if(n.length===0)return!1;const{decimalSeparator:a}=T.value;return!n.some(e=>{if(typeof e=="number")return!Number.isInteger(e);const i=e.trim();return i.includes(a)||i.includes(".")})}),O=s=>{if(s==null)return null;if(typeof s=="number")return s;const t=s.trim();if(!t)return null;const{decimalSeparator:n,thousandSeparator:a,minorUnit:e}=T.value,i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),N=a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),I=new RegExp(`[^0-9\\-\\${i}\\${N}]`,"g");let u=t.replace(I,"");a&&(u=u.replace(new RegExp(N,"g"),"")),n&&n!=="."&&(u=u.replace(new RegExp(i,"g"),"."));const w=u.includes("."),g=Number(u);return Number.isFinite(g)?!w&&H.value&&e>0?g/Math.pow(10,e):g:null},k=s=>{const t=T.value,n=O(s);if(n===null)return`${t.symbol}0.00`;const a=n<0,i=Math.abs(n).toFixed(t.minorUnit),[N,I]=i.split("."),u=N.replace(/\B(?=(\d{3})+(?!\d))/g,t.thousandSeparator),w=t.minorUnit>0?`${u}${t.decimalSeparator}${I}`:u,g=t.symbolPosition==="right"?`${w}${t.symbol}`:`${t.symbol}${w}`;return a?`-${g}`:g},W=_(()=>c.value?.totals?.subtotal||c.value?.subtotal||0),z=_(()=>c.value?.totals?.total_tax||c.value?.total_tax||0),G=_(()=>c.value?.totals?.shipping_total||c.value?.shipping_total||0),J=_(()=>c.value?.totals?.discount_total||c.value?.discount_total||0),K=_(()=>c.value?.totals?.total||c.value?.total||0),M=(s,t)=>{const n=Number(x[s]);return Number.isFinite(n)&&n>0?n:t},V=async(s,t)=>{const n=Number(x[s.key]),a=Number.isFinite(n)&&n>0?n:1,e=Math.max(1,a+t);if(x[s.key]=e,t>0&&s.productId){await $.addItem(s.productId,t,s.variationId??void 0,s.variation);return}await $.updateItem(s.key,e)},X=async s=>{await $.removeItem(s)};return(s,t)=>{const n=ot,a=it;return p(),m("div",pt,[o("div",yt,[P(n,{"item-count":r(Q),"cart-label":"Items","cart-link":null},null,8,["item-count"]),o("div",mt,[P(a,{class:"pdp-back",to:"/"},{default:U(()=>[...t[0]||(t[0]=[j("Regresar al catalogo",-1)])]),_:1})]),t[13]||(t[13]=o("div",{class:"cart-title-row"},[o("h1",{class:"hero-title"},"Carrito")],-1)),o("div",ft,[o("section",bt,[r(h)?(p(),m("p",_t,"Cargando carrito...")):B("",!0),r(R)?(p(),m("p",gt,f(r(R)),1)):B("",!0),!r(h)&&r(q).length===0?(p(),m("div",vt,[t[2]||(t[2]=o("p",null,"Tu carrito esta vacio.",-1)),P(a,{class:"btn btn-primary",to:"/"},{default:U(()=>[...t[1]||(t[1]=[j("Ver catalogo",-1)])]),_:1})])):r(h)?B("",!0):(p(),m("div",ht,[(p(!0),m(ct,null,lt(r(q),e=>(p(),m("article",{key:e.key,class:"cart-item"},[o("div",kt,[o("div",Nt,[e.image?(p(),m("img",{key:0,src:e.image,alt:e.name},null,8,wt)):(p(),m("span",$t,"Sin imagen"))])]),o("div",It,[o("div",St,[o("strong",null,f(e.name),1),o("button",{class:"btn-link",type:"button",disabled:r(h),onClick:i=>X(e.key)}," Quitar ",8,Ct)]),o("p",xt,"Precio: "+f(k(e.price)),1),o("div",qt,[o("div",Ft,[t[3]||(t[3]=o("span",null,"Cantidad",-1)),o("div",Tt,[o("button",{class:"qty-btn",type:"button",disabled:r(h)||M(e.key,e.quantity)<=1,onClick:i=>V(e,-1)}," - ",8,Pt),o("span",Ut,f(M(e.key,e.quantity)),1),o("button",{class:"qty-btn",type:"button",disabled:r(h),onClick:i=>V(e,1)}," + ",8,jt)])])])]),o("div",Bt,[t[4]||(t[4]=o("span",null,"Total",-1)),o("strong",null,f(k(e.lineTotal||e.price)),1)])]))),128))]))]),o("aside",Rt,[t[11]||(t[11]=o("h2",{class:"section-title"},"Resumen",-1)),o("div",Et,[t[5]||(t[5]=o("span",null,"Subtotal",-1)),o("span",null,f(k(r(W))),1)]),o("div",Mt,[t[6]||(t[6]=o("span",null,"Descuento",-1)),o("span",null,"- "+f(k(r(J))),1)]),o("div",Vt,[t[7]||(t[7]=o("span",null,"Envio",-1)),o("span",null,f(k(r(G))),1)]),o("div",At,[t[8]||(t[8]=o("span",null,"Impuestos",-1)),o("span",null,f(k(r(z))),1)]),o("div",Dt,[t[9]||(t[9]=o("span",null,"Total",-1)),o("strong",null,f(k(r(K))),1)]),!r(h)&&r(q).length>0?(p(),ut(a,{key:0,class:"btn btn-primary",to:"/checkout"},{default:U(()=>[...t[10]||(t[10]=[j(" Ir a checkout ",-1)])]),_:1})):(p(),m("button",Lt,"Ir a checkout")),t[12]||(t[12]=o("p",{class:"hero-subtitle"},"Checkout se conecta con WooCommerce via BFF.",-1))])])])])}}});export{zt as default};
